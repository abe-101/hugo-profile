<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=icon href=../../images/fav.png type=image/gif><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-216916075-1','auto');ga('send','pageview');}</script><link rel=stylesheet href=../../css/bootstrap.min.css media=all><link rel=stylesheet href=../../css/all.min.css media=all><link rel=stylesheet href=../../css/fontawesome.min.css media=all><link rel=stylesheet href=../../css/v3/darkmode.css media=all><style>html{scrollbar-width:thin;scrollbar-color:#6c757d transparent}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:#6c757d}</style><link rel=stylesheet href=../../css/v3/navbar-footer.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;1,100;1,300&display=swap" rel=stylesheet><script src=../../js/popper.min.js></script><meta name=description content="Nextcloud: integrated on-premises content collaboration platform"><title>How to Install Nextcloud</title><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-216916075-1','auto');ga('send','pageview');}</script><meta property="og:title" content="How to Install Nextcloud"><meta property="og:description" content="Nextcloud: integrated on-premises content collaboration platform"><meta property="og:type" content="article"><meta property="og:url" content="https://habet.dev/blog/how-to-install-nextcloud/"><meta property="og:image" content="https://habet.dev/images/nextcloud-dashboard.png"><meta property="article:published_time" content="2022-01-12T09:35:54-05:00"><meta property="article:modified_time" content="2022-01-12T09:35:54-05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://habet.dev/images/nextcloud-dashboard.png"><meta name=twitter:title content="How to Install Nextcloud"><meta name=twitter:description content="Nextcloud: integrated on-premises content collaboration platform"><link href=../../css/v3/post.css rel=stylesheet></head><body class=text-dark><script src=../../js/jquery.slim.min.js></script><script src=../../js/bootstrap.min.js></script><div class=container><nav class="pt-3 navbar navbar-expand-lg navbar-light" data-aos=fade-down data-aos-easing=linear data-aos-duration=500><a class=navbar-brand href=../../><img src=../../images/fav.png width=30 height=30 class="d-inline-block align-top">
Abe's Portfolio</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navbarNavDropdown aria-controls=navbarNavDropdown aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavDropdown><ul class="navbar-nav ml-auto text-center"><li class="nav-item navbar-text"><a class="nav-link text-dark" href=../../#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class="nav-link text-dark" href=../../#projects aria-label=projects>Projects</a></li><li class="nav-item navbar-text"><a class="nav-link text-dark" href=../../#contact aria-label=contact>Contact</a></li><li class="nav-item navbar-text"><a class="nav-link text-dark" href=../../blog aria-label=Blog>Blog</a></li><li class="nav-item navbar-text"><div class="custom-control custom-switch"><input type=checkbox class=custom-control-input id=customSwitch1 autocomplete=on>
<label class="pt-2 darkmode-label" for=customSwitch1 style=cursor:pointer><i class="fas fa-lg fa-moon"></i><i class="fas fa-lg fa-sun d-none text-warning"></i></label></div></li></ul></div></nav></div><section style=font-family:roboto,sans-serif><div class="bottom-share d-none"><div class="my-1 mb-3 share-container"><div class="d-block my-1 text-center" data-toggle=tooltip data-placement=left title="Tooltip on left"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><path fill="#03a9f4" d="M42 37c0 2.762-2.239 5-5 5H11c-2.762.0-5-2.238-5-5V11c0-2.762 2.238-5 5-5h26c2.761.0 5 2.238 5 5V37z"/><path fill="#fff" d="M36 17.12c-.882.391-1.999.758-3 .88 1.018-.604 2.633-1.862 3-3-.951.559-2.671 1.156-3.793 1.372C31.311 15.422 30.033 15 28.617 15 25.897 15 24 17.305 24 20v2c-4 0-7.9-3.047-10.327-6-.427.721-.667 1.565-.667 2.457.0 1.819 1.671 3.665 2.994 4.543-.807-.025-2.335-.641-3-1 0 .016.0.036.0.057.0 2.367 1.661 3.974 3.912 4.422C16.501 26.592 16 27 14.072 27c.626 1.935 3.773 2.958 5.928 3-1.686 1.307-4.692 2-7 2-.399.0-.615.022-1-.023C14.178 33.357 17.22 34 20 34c9.057.0 14-6.918 14-13.37.0-.212-.007-.922-.018-1.13C34.95 18.818 35.342 18.104 36 17.12"/></svg></div><div class="d-block my-1 text-center" data-toggle=tooltip data-placement=left title="Tooltip on left"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="48" data-name="Layer 1" viewBox="0 0 32 32"><path fill="#ea4435" d="M16.58 19.1068l-12.69-8.0757A3 3 0 017.1109 5.97l9.31 5.9243L24.78 6.0428A3 3 0 0128.22 10.9579z"/><path fill="#00ac47" d="M25.5 5.5h4a0 0 0 010 0v18a3 3 0 01-3 3h0a3 3 0 01-3-3V7.5a2 2 0 012-2z" transform="rotate(180 26.5 16)"/><path fill="#ffba00" d="M29.4562 8.0656c-.0088-.06-.0081-.1213-.0206-.1812-.0192-.0918-.0549-.1766-.0823-.2652a2.9312 2.9312.0 00-.0958-.2993c-.02-.0475-.0508-.0892-.0735-.1354A2.9838 2.9838.0 0028.9686 6.8c-.04-.0581-.09-.1076-.1342-.1626a3.0282 3.0282.0 00-.2455-.2849c-.0665-.0647-.1423-.1188-.2146-.1771a3.02 3.02.0 00-.24-.1857c-.0793-.0518-.1661-.0917-.25-.1359-.0884-.0461-.175-.0963-.267-.1331-.0889-.0358-.1837-.0586-.2766-.0859s-.1853-.06-.2807-.0777a3.0543 3.0543.0 00-.357-.036c-.0759-.0053-.1511-.0186-.2273-.018a2.9778 2.9778.0 00-.4219.0425c-.0563.0084-.113.0077-.1689.0193a33.211 33.211.0 00-.5645.178c-.0515.022-.0966.0547-.1465.0795A2.901 2.901.0 0023.5 8.5v5.762l4.72-3.3043a2.8878 2.8878.0 001.2359-2.8923z"/><path fill="#4285f4" d="M5.5 5.5h0a3 3 0 013 3v18a0 0 0 010 0h-4a2 2 0 01-2-2V8.5a3 3 0 013-3z"/><path fill="#c52528" d="M2.5439 8.0656c.0088-.06.0081-.1213.0206-.1812.0192-.0918.0549-.1766.0823-.2652A2.9312 2.9312.0 012.7426 7.32c.02-.0475.0508-.0892.0736-.1354A2.9719 2.9719.0 013.0316 6.8c.04-.0581.09-.1076.1342-.1626a3.0272 3.0272.0 01.2454-.2849c.0665-.0647.1423-.1188.2147-.1771a3.0005 3.0005.0 01.24-.1857c.0793-.0518.1661-.0917.25-.1359A2.9747 2.9747.0 014.3829 5.72c.089-.0358.1838-.0586.2766-.0859s.1853-.06.2807-.0777a3.0565 3.0565.0 01.357-.036c.076-.0053.1511-.0186.2273-.018a2.9763 2.9763.0 01.4219.0425c.0563.0084.113.0077.169.0193a2.9056 2.9056.0 01.286.0888 2.9157 2.9157.0 01.2785.0892c.0514.022.0965.0547.1465.0795a2.9745 2.9745.0 01.3742.21A2.9943 2.9943.0 018.5 8.5v5.762L3.78 10.9579A2.8891 2.8891.0 012.5439 8.0656z"/></svg></div><div class="d-block my-1 text-center" data-toggle=tooltip data-placement=left title="Tooltip on left"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="38" height="48"><path fill="#4caf50" d="M8.002.0h-.004C3.587.0.0 3.588.0 8a7.94 7.94.0 001.523 4.689l-.997 2.972 3.075-.983A7.93 7.93.0 008.002 16C12.413 16 16 12.411 16 8s-3.587-8-7.998-8z"/><path fill="#fafafa" d="M12.657 11.297c-.193.545-.959.997-1.57 1.129-.418.089-.964.16-2.802-.602-2.351-.974-3.865-3.363-3.983-3.518-.113-.155-.95-1.265-.95-2.413s.583-1.707.818-1.947c.193-.197.512-.287.818-.287.099.0.188.005.268.009.235.01.353.024.508.395.193.465.663 1.613.719 1.731.057.118.114.278.034.433-.075.16-.141.231-.259.367s-.23.24-.348.386c-.108.127-.23.263-.094.498.136.23.606.997 1.298 1.613.893.795 1.617 1.049 1.876 1.157.193.08.423.061.564-.089.179-.193.4-.513.625-.828.16-.226.362-.254.574-.174.216.075 1.359.64 1.594.757.235.118.39.174.447.273.056.099.056.564-.137 1.11z"/></svg></div></div><div class=text-center data-toggle=tooltip data-placement=left title="Share this article"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 25 25"><g transform="translate(0 -1027.362)"><circle cx="657.054" cy="437.094" r="15.268" fill="#9257a2" fill-rule="evenodd" transform="translate(-525.439 682.007) scale(.81871)"/><path fill="#6c4676" style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal" d="M12.943359 24.984375A12.5 12.5.0 0013.384766 24.96875 12.5 12.5.0 0014.625 24.818359 12.5 12.5.0 0015.84375 24.544922 12.5 12.5.0 0017.029297 24.150391 12.5 12.5.0 0018.169922 23.640625 12.5 12.5.0 0019.253906 23.017578 12.5 12.5.0 0020.269531 22.291016 12.5 12.5.0 0021.208984 21.466797 12.5 12.5.0 0022.060547 20.552734 12.5 12.5.0 0022.816406 19.558594 12.5 12.5.0 0023.470703 18.492188 12.5 12.5.0 0024.013672 17.367188 12.5 12.5.0 0024.441406 16.193359 12.5 12.5.0 0024.496094 15.974609L14.265625 5.7441406C13.812473 5.2910406 13.187396 5.0097656 12.5 5.0097656 11.12521 5.0097656 10 6.1349656 10 7.5097656 10 7.5307656 10.005259 7.5493125 10.005859 7.5703125 9.4896699 7.8077125 9.0133544 8.1147296 8.5878906 8.4804688 8.374766 8.6636758 8.1738297 8.8614634 7.9882812 9.0722656 7.0619905 10.124095 6.5 11.499953 6.5 13.009766 6.5 13.488466 6.573385 13.948784 6.6796875 14.396484 5.9748502 14.839884 5.5 15.620266 5.5 16.509766 5.5 17.197166 5.7812253 17.822291 6.234375 18.275391L12.943359 24.984375z" color="#000" font-family="sans-serif" font-weight="400" transform="translate(0 1027.362)"/><path fill="#fff" d="m7.9941406 1c-1.3747895.0-2.5 1.1252-2.5 2.5.0.02072.00535.039943.00586.060547C3.4352817 4.5101164 1.9941406 6.5842949 1.9941406 9c0 .4787281.073385.9389814.1796875 1.386719C1.4689908 10.830108.99414062 11.610545.99414062 12.5c0 1.3748 1.12521048 2.5 2.49999998 2.5.6665407.0 1.2712865-.268072 1.7207032-.697266C6.0479519 14.74009 6.9900874 15 7.9941406 15 8.9981981 15 9.9421095 14.741984 10.775391 14.304688 11.224611 14.732762 11.828584 15 12.494141 15c1.374789.0 2.5-1.1252 2.5-2.5.0-.887901-.472993-1.667522-1.175782-2.111328C13.924794 9.941126 13.994141 9.4787929 13.994141 9c0-2.4173981-1.439125-4.4947611-3.50586-5.4433594 446e-6-.019294.0059-.037245.0059-.056641.0-1.3748-1.1252108-2.5-2.5000004-2.5zm0 1c.8343495.0 1.5.6657 1.5 1.5.0.8344-.6656505 1.5-1.5 1.5-.8343494.0-1.5-.6656-1.5-1.5.0-.8343.6656506-1.5 1.5-1.5zM5.7363281 4.5507812C6.1363719 5.4015827 6.9962448 6 7.9941406 6 8.9914269 6 9.8515843 5.4027009 10.251953 4.5527344 11.874506 5.3778725 12.994141 7.0495149 12.994141 9c0 .358063-.04812.702711-.119141 1.039062C12.74983 10.019561 12.62455 10 12.494141 10c-1.37479.0-2.5000004 1.1252-2.5000004 2.5.0.347738.073318.676884.2031254.978516C9.5317018 13.806899 8.7887215 14 7.9941406 14 7.1996182 14 6.4561816 13.808725 5.7910156 13.480469 5.9212525 13.178414 5.9941406 12.848348 5.9941406 12.5c0-1.3748-1.1252104-2.5-2.5-2.5C3.3643933 10 3.2397998 10.01975 3.1152344 10.03906 3.0437876 9.7026723 2.9941406 9.3583587 2.9941406 9c0-1.9503184 1.1196952-3.6242663 2.7421875-4.4492188zM3.4941406 11c.8343495.0 1.5.6657 1.5 1.5.0.8344-.6656505 1.5-1.5 1.5-.8343494.0-1.5-.6656-1.5-1.5.0-.8343.6656506-1.5 1.5-1.5zm9.0000004.0c.834349.0 1.5.6657 1.5 1.5.0.8344-.665651 1.5-1.5 1.5-.83435.0-1.5-.6656-1.5-1.5.0-.8343.66565-1.5 1.5-1.5z" color="#000" font-family="sans-serif" font-weight="400" overflow="visible" transform="translate(4.506 1031.372)" style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal"/></g></svg></div></div><div class=container><div class="row blog-page-color"><div class="col-md-9 py-4 px-0"><div class="rounded shadow bg-light p-3 px-md-5 bg-light"><h1 class="pb-2 text-center">How to Install Nextcloud</h1><article><p>If you followed <a href=https://habet.dev/blog/raspberry-pi-encrypted-boot-with-ssh/>this</a> you now have a server. It&rsquo;s now time to start utilizing it. In this guide we will be setting up Nextcloud.</p><p>Nextcloud is a free (Open Source) Dropbox-like software. The project is written in PHP and JavaScript. It supports many database systems such as MySQL/MariaDB, PostgreSQL, Oracle Database and SQLite.</p><p>To allow Synchronization between server, desktop and mobile phone, Nextcloud provides applications for Windows, Linux and Mac desktop. As well as a mobile app for Android and iOS.</p><p>Nextcloud is not just a Dropbox clone. It provides additional features like Calendar, Contacts, Scheduled tasks and web forms.</p><p>In this tutorial, we will show you how to install and configure the latest Nextcloud release (at the time of writing it&rsquo;s version 23) on a Debian 11 server. We will run Nextcloud with an Nginx web server and PHP7.4-FPM and use MariaDB server as the database system.</p><p>This tutorial has been tested using Debian 11.</p><h2 id=prerequisite>Prerequisite</h2><ul><li>Server running Debian 11 or derivatives</li><li>Root privileges</li></ul><h2 id=the-process>The process</h2><ul><li>Install Nginx webserver</li><li>Install and Configure PHP7.4-FPM</li><li>Install and Configure MariaDB</li><li>Generate SSL Let’s Encrypt</li><li>Download Nextcloud 23</li><li>Configure Nginx Host for Nextcloud</li><li>UFW Firewall Configuration</li><li>Nextcloud Post-Installation</li></ul><h2 id=1-install-nginx-web-server>1. Install Nginx Web-server</h2><p>Log in to the server and update the repository, then install the Nginx web server using the apt command as shown below.</p><pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y
sudo apt install nginx -y
</code></pre><p>After the installation is complete, start the Nginx service and enable the service to launch every time at system boot using systemctl.</p><pre><code>sudo systemctl start nginx
sudo systemctl enable nginx
</code></pre><p>The Nginx service is up and running, check it using the following command.</p><pre><code>sudo systemctl status nginx
</code></pre><p>And you will get the result as below:</p><pre><code>● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Tue 1998-05-21 22:10:13 EST; 4 days ago
       Docs: man:nginx(8)
    Process: 27176 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
    Process: 27177 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
    Process: 1328730 ExecReload=/usr/sbin/nginx -g daemon on; master_process on; -s reload (code=exited, status=0/SUCCESS)
   Main PID: 27178 (nginx)
      Tasks: 5 (limit: 4144)
        CPU: 4min 57.436s
     CGroup: /system.slice/nginx.service
             ├─  27178 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
             ├─1328731 nginx: worker process
             ├─1328732 nginx: worker process
             ├─1328733 nginx: worker process
             └─1328734 nginx: worker process 
</code></pre><h2 id=2-install-and-configure-php74-fpm>2. Install and Configure PHP7.4-FPM</h2><p>Install PHP and PHP-FPM packages neede by Nextcloud using the apt command below:</p><pre><code>sudo apt install php7.4 php7.4-fpm php7.4-common php7.4-pgsql php7.4-cli php7.4-gd php7.4-json php7.4-curl php7.4-zip php7.4-xml php7.4-mbstring php7.4-bz2 php7.4-intl php7.4-bcmath php7.4-gmp php-imagick php7.4-opcache php7.4-readline
sudo apt install php-fpm php-curl php-cli php-mysql php-gd php-common php-xml php-json php-intl php-pear php-imagick php-dev php-common php-mbstring php-zip php-soap php-bz2 -y
</code></pre><p>After the installation is complete, we will configure the php.ini files for php-fpm and php-cli.</p><pre><code>sudoedit /etc/php/7.4/fpm/php.ini
</code></pre><p>Change memory limit to 512M</p><p>Change max_execution_time to 256</p><pre><code>sudoedit /etc/php/7.4/fpm/pool.d/www.conf
</code></pre><p>Uncomment those lines below:</p><pre><code>env[HOSTNAME] = $HOSTNAME
env[PATH] = /usr/local/bin:/usr/bin:/bin
env[TMP] = /tmp
env[TMPDIR] = /tmp
env[TEMP] = /tmp
</code></pre><p>Restart the PHP7.4-FPM service and enable it to launch every time on system boot.</p><pre><code>sudo systemctl restart php7.4-fpm
sudo systemctl enable php7.4-fpm
</code></pre><h2 id=3-install-and-configure-mariadb>3. Install and Configure MariaDB</h2><p>In this step, we will install the latest MariaDB version and create a new database for the Nextcloud installation. The latest version MariaDB packages are available on the repository by default.</p><pre><code>sudo apt install mariadb-server -y
</code></pre><p>After the installation is complete, start the MariaDB service and enable it to launch every time at system boot.</p><pre><code>sudo systemctl start mariadb
sudo systemctl enable mariadb
</code></pre><p>Next, we will configure the MariaDB root password using the ‘mysql_secure_installation’ command.</p><p>Run the following command:</p><pre><code>sudo mysql_secure_installation
</code></pre><p>You will be asked for some configuration of MariaDB Server. Type the new root password for MariaDB Server.</p><pre><code>Enter current password for root (enter for none): Press Enter
Set root password? [Y/n] Y
Remove anonymous users? [Y/n] Y
Disallow root login remotely? [Y/n] Y
Remove test database and access to it? [Y/n] Y
Reload privilege tables now? [Y/n] Y
</code></pre><p>Next, we will create a new database for nextcloud installation. We will create a new database named ‘nextcloud_db’ with the user ‘nextclouduser’ and password ‘Nextclouduser421@’.</p><p>Login to the MySQL shell as a root user with mysql command.</p><pre><code>sudo mysql -u root -p
</code></pre><p>Now create the database and user with a password by running following MySQL queries.</p><p>Replace <code>'Nextclouduser421@'</code> with your password.</p><pre><code>create database nextcloud_db;
create user nextclouduser@localhost identified by 'Nextclouduser421@';
grant all privileges on nextcloud_db.* to nextclouduser@localhost identified by 'Nextclouduser421@';
flush privileges;
</code></pre><p>The new database and user for the nextcloud installation has been created.</p><h2 id=4-genenrate-ssl-lets-encrypt>4. Genenrate ssl Let’s Encrypt</h2><p>We will secure Nextcloud using a free SSL Certificate from Let’s Encrypt. Install the Let’s Encrypt tool:</p><pre><code>sudo apt install certbot -y
</code></pre><p>Next we will generate the SSL certificate for our domain name “cloud.example.com”:</p><p>If you followed <a href=https://habet.dev/blog/self-hosting-and-securing-web-services-out-of-your-home-with-cloudflare-tunnel/#4-create-a-configuration-file>this</a> giude to set up a Cloudeflare tunnel you will need to add an additional service for this domain.</p><pre><code>certbot --standalone -d cloud.example.com
</code></pre><p>You will be asked for the email address, and it’s used for the renew notification. For the Letsencrypt TOS agreement, type ‘A’ to agree and for the share email address, you can type ‘N’ for No.</p><p>The SSL certificates Letsencrypt for the Nextcloud domain name has been generated, all located at the ‘/etc/letsencrypt/live/your-domain’ directory.</p><h2 id=5-download-nextcloud>5. Download Nextcloud</h2><p>Go to <code>/var/www</code> directory and download the latest version of Nextcloud:</p><pre><code>cd /var/www/
sudo wget https://download.nextcloud.com/server/releases/nextcloud-23.0.0.zip
</code></pre><p>Extract the Nextcloud source code and you will get a new directory ‘netxcloud’, change the ownership of the Nextcloud directory to user ‘www-data’.</p><pre><code>sudo unzip nextcloud-23.0.0.zip
sudo chown -R www-data:www-data /var/www/nextcloud
</code></pre><p>As a result, the Nextcloud has been downloaded under the ‘/var/www/nextcloud’ directory, and it will be the web root directory.</p><h2 id=6-configure-nginx-virtual-host-for-nextcloud>6. Configure Nginx Virtual Host for Nextcloud</h2><p>In this step, we will configure the nginx virtual host for nextcloud. We will configure nextcloud to run under the HTTPS connection and will force the HTTP connection automatically to the secure HTTPS connection.</p><p>Now go to the ‘/etc/nginx/sites-available’ directory and create a new virtual host file ‘nextcloud’:</p><pre><code>cd /etc/nginx/sites-available/
sudoedit nextcloud
</code></pre><p>There, paste the following configuration.</p><pre><code>upstream php-handler {
    #server 127.0.0.1:9000;
    server unix:/var/run/php/php7.4-fpm.sock;
}

server {
    listen 80;
    listen [::]:80;
    server_name cloud.example.com;

    # Enforce HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443      ssl http2;
    listen [::]:443 ssl http2;
    server_name cloud.example.com;

    # Use Mozilla's guidelines for SSL/TLS settings
    # https://mozilla.github.io/server-side-tls/ssl-config-generator/
    ssl_certificate     /etc/ssl/nginx/cloud.example.com.crt;
    ssl_certificate_key /etc/ssl/nginx/cloud.example.com.key;

    # HSTS settings
    # WARNING: Only add the preload option once you read about
    # the consequences in https://hstspreload.org/. This option
    # will add the domain to a hardcoded list that is shipped
    # in all major browsers and getting removed from this list
    # could take several months.
    #add_header Strict-Transport-Security &quot;max-age=15768000; includeSubDomains; preload;&quot; always;

    # set max upload size and increase upload timeout:
    client_max_body_size 512M;
    client_body_timeout 300s;
    fastcgi_buffers 64 4K;

    # Enable gzip but do not remove ETag headers
    gzip on;
    gzip_vary on;
    gzip_comp_level 4;
    gzip_min_length 256;
    gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;
    gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;

    # Pagespeed is not supported by Nextcloud, so if your server is built
    # with the `ngx_pagespeed` module, uncomment this line to disable it.
    #pagespeed off;

    # HTTP response headers borrowed from Nextcloud `.htaccess`
    add_header Referrer-Policy                      &quot;no-referrer&quot;   always;
    add_header X-Content-Type-Options               &quot;nosniff&quot;       always;
    add_header X-Download-Options                   &quot;noopen&quot;        always;
    add_header X-Frame-Options                      &quot;SAMEORIGIN&quot;    always;
    add_header X-Permitted-Cross-Domain-Policies    &quot;none&quot;          always;
    add_header X-Robots-Tag                         &quot;none&quot;          always;
    add_header X-XSS-Protection                     &quot;1; mode=block&quot; always;

    # Remove X-Powered-By, which is an information leak
    fastcgi_hide_header X-Powered-By;

    # Path to the root of your installation
    root /var/www/nextcloud;

    # Specify how to handle directories -- specifying `/index.php$request_uri`
    # here as the fallback means that Nginx always exhibits the desired behaviour
    # when a client requests a path that corresponds to a directory that exists
    # on the server. In particular, if that directory contains an index.php file,
    # that file is correctly served; if it doesn't, then the request is passed to
    # the front-end controller. This consistent behaviour means that we don't need
    # to specify custom rules for certain paths (e.g. images and other assets,
    # `/updater`, `/ocm-provider`, `/ocs-provider`), and thus
    # `try_files $uri $uri/ /index.php$request_uri`
    # always provides the desired behaviour.
    index index.php index.html /index.php$request_uri;

    # Rule borrowed from `.htaccess` to handle Microsoft DAV clients
    location = / {
        if ( $http_user_agent ~ ^DavClnt ) {
            return 302 /remote.php/webdav/$is_args$args;
        }
    }

    location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
    }

    # Make a regex exception for `/.well-known` so that clients can still
    # access it despite the existence of the regex rule
    # `location ~ /(\.|autotest|...)` which would otherwise handle requests
    # for `/.well-known`.
    location ^~ /.well-known {
        # The rules in this block are an adaptation of the rules
        # in `.htaccess` that concern `/.well-known`.

        location = /.well-known/carddav { return 301 /remote.php/dav/; }
        location = /.well-known/caldav  { return 301 /remote.php/dav/; }

        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }
        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }

        # Let Nextcloud's API for `/.well-known` URIs handle all other
        # requests by passing them to the front-end controller.
        return 301 /index.php$request_uri;
    }

    # Rules borrowed from `.htaccess` to hide certain paths from clients
    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)  { return 404; }
    location ~ ^/(?:\.|autotest|occ|issue|indie|db_|console)                { return 404; }

    # Ensure this block, which passes PHP files to the PHP process, is above the blocks
    # which handle static assets (as seen below). If this block is not declared first,
    # then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`
    # to the URI, resulting in a HTTP 500 error response.
    location ~ \.php(?:$|/) {
        # Required for legacy support
        rewrite ^/(?!index|remote|public|cron|core\/ajax\/update|status|ocs\/v[12]|updater\/.+|oc[ms]-provider\/.+|.+\/richdocumentscode\/proxy) /index.php$request_uri;

        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
        set $path_info $fastcgi_path_info;

        try_files $fastcgi_script_name =404;

        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $path_info;
        fastcgi_param HTTPS on;

        fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice
        fastcgi_param front_controller_active true;     # Enable pretty urls
        fastcgi_pass php-handler;

        fastcgi_intercept_errors on;
        fastcgi_request_buffering off;
    }

    location ~ \.(?:css|js|svg|gif|png|jpg|ico|wasm|tflite)$ {
        try_files $uri /index.php$request_uri;
        expires 6M;         # Cache-Control policy borrowed from `.htaccess`
        access_log off;     # Optional: Don't log access to assets

        location ~ \.wasm$ {
            default_type application/wasm;
        }
    }

    location ~ \.woff2?$ {
        try_files $uri /index.php$request_uri;
        expires 7d;         # Cache-Control policy borrowed from `.htaccess`
        access_log off;     # Optional: Don't log access to assets
    }

    # Rule borrowed from `.htaccess`
    location /remote {
        return 301 /remote.php$request_uri;
    }

    location / {
        try_files $uri $uri/ /index.php$request_uri;
    }
}
</code></pre><p>Save and exit.</p><p>Enable the virtual host and make sure there is no errors:</p><pre><code>sudo ln -s /etc/nginx/sites-available/nextcloud /etc/nginx/sites-enabled/
sudo nginx -t
</code></pre><p>Now restart Nginx service using the command:</p><pre><code>sudo systemctl restart nginx
</code></pre><h2 id=7-configure-ufw-firewall>7. Configure UFW Firewall</h2><p>In this tutorial, we will turn on the firewall, and we will be using the UFW firewall for Ubuntu.</p><p>Add the SSH, HTTP and HTTPS to the UFW firewall list using the command below.</p><pre><code>sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
</code></pre><p>Now Enable the firewall and check the allowed service and port:</p><pre><code>sudo ufw enable
sudo status numbered
</code></pre><p>And you will see HTTP port 80 and HTTPS port 443 is on the list.</p><h2 id=8-nextcloud-post-installation>8. Nextcloud Post-installation</h2><p>Open a Browser on your local network and go to the nextclud URL:
<a href=https://cloud.example.com>https://cloud.example.com</a></p><p><img src=../../images/nextcloud-admin.png alt=nextcloud-admin></p><p>On the top of the page we need to create an admin user for Nextcloud. Type in a user name and password. On the &lsquo;data folder&rsquo; type the full of the &lsquo;data&rsquo; directory. <code>/var/www/nextcloud/data</code></p><p>On the bottom of the page you will need to enter the database info from step 3. Then click the &lsquo;Finish Setup&rsquo; button.</p><p>After the installation is complete, you will get the Nextcloud dashboard.</p><p><img src=../../images/nextcloud-dashboard.png alt=nextcloud-dashboard></p></article></div></div><div class="col-md-3 py-4"><div class="bg-light shadow p-4 rounded mb-2 bg-light"><h4>Table of content</h4><nav id=TableOfContents><ul><li><a href=#prerequisite>Prerequisite</a></li><li><a href=#the-process>The process</a></li><li><a href=#1-install-nginx-web-server>1. Install Nginx Web-server</a></li><li><a href=#2-install-and-configure-php74-fpm>2. Install and Configure PHP7.4-FPM</a></li><li><a href=#3-install-and-configure-mariadb>3. Install and Configure MariaDB</a></li><li><a href=#4-genenrate-ssl-lets-encrypt>4. Genenrate ssl Let’s Encrypt</a></li><li><a href=#5-download-nextcloud>5. Download Nextcloud</a></li><li><a href=#6-configure-nginx-virtual-host-for-nextcloud>6. Configure Nginx Virtual Host for Nextcloud</a></li><li><a href=#7-configure-ufw-firewall>7. Configure UFW Firewall</a></li><li><a href=#8-nextcloud-post-installation>8. Nextcloud Post-installation</a></li></ul></nav></div><div class="bg-light shadow p-4 rounded mt-2 bg-light"><h4>Share article with</h4><ul><li><a target=blank class=text-info href="https://twitter.com/share?text=How%20to%20Install%20Nextcloud&url=https%3a%2f%2fhabet.dev%2fblog%2fhow-to-install-nextcloud%2f">Twitter</a></li><li><a target=blank class=text-success href="https://api.whatsapp.com/send?text=How%20to%20Install%20Nextcloud: https%3a%2f%2fhabet.dev%2fblog%2fhow-to-install-nextcloud%2f" data-action=share/whatsapp/share>Whatsapp</a></li><li><a class=text-danger target=blank href="mailto:?subject=How%20to%20Install%20Nextcloud&body=Check out this site https%3a%2f%2fhabet.dev%2fblog%2fhow-to-install-nextcloud%2f">Email</a></li></ul></div></div></div></div></section><footer><div class="news container py-3" data-aos=fade-up data-aos-easing=linear data-aos-once=true><div class="h3 text-center text-dark py-3 font-weight-bold">Recent posts</div><div class="row justify-content-center"><div class="col-lg-4 col-md-6 pt-2"><a href=../../blog/how-to-install-nextcloud/ class=post-card-link><div class="card h-100"><div class="card-head px-2 py-3"><h5 class="card-title font-weight-bold px-2">How to Install Nextcloud</h5><div class=px-2>If you followed this you now have a server. It&rsquo;s now time to start utilizing it. In this guide we will be setting up Nextcloud.
Nextcloud is a free (Open Source) Dropbox-like software. The project is written in PHP and JavaScript. It supports many database systems such as MySQL/MariaDB, …</div></div><div class="mt-auto card-footer"><span class=float-left>January 12, 2022</span>
<a href=../../blog/how-to-install-nextcloud/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div><div class="col-lg-4 col-md-6 pt-2"><a href=../../blog/self-hosting-and-securing-web-services-out-of-your-home-with-cloudflare-tunnel/ class=post-card-link><div class="card h-100"><div class="card-head px-2 py-3"><h5 class="card-title font-weight-bold px-2">Self Hosting and Securing Web Services Out of Your Home With Cloudflare Tunnel</h5><div class=px-2>Why a tunnel? Opening up a port on a home network isn’t the greatest idea. It is a security risk, a hole waiting for a hacker/bot to sneak in using a known vulnerability. Many ISP‘s and routers prevent you from opening up ports 80 and 443. Another challenge you will face is setting up a dynamic …</div></div><div class="mt-auto card-footer"><span class=float-left>December 30, 2021</span>
<a href=../../blog/self-hosting-and-securing-web-services-out-of-your-home-with-cloudflare-tunnel/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div><div class="col-lg-4 col-md-6 pt-2"><a href=../../blog/raspberry-pi-encrypted-boot-with-ssh/ class=post-card-link><div class="card h-100"><div class="card-head px-2 py-3"><h5 class="card-title font-weight-bold px-2">Raspberry Pi Encrypted Boot With Ssh</h5><div class=px-2>Please note this project is a fork from ViRb3, I&rsquo;ve made some minor changes here.
Tested on Raspberry Pi 3B & 4B with Ubuntu Server 21.04 & Debian 11
Introduction This guide will show you how to encrypt your Raspberry Pi&rsquo;s root partition and set up an initramfs that will prompt …</div></div><div class="mt-auto card-footer"><span class=float-left>December 23, 2021</span>
<a href=../../blog/raspberry-pi-encrypted-boot-with-ssh/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div></div></div><div class=text-center><span class=px-1><a class="text-dark text-decoration-none" href=https://github.com/abe-101 aria-label=github><svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792"><path d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5-16 11q-17 2-17-11l16-11q17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5T1376 1664h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5H416q-119 0-203.5-84.5T128 1376V416q0-119 84.5-203.5T416 128h960q119 0 203.5 84.5T1664 416z"/></svg></a></span><span class=px-1><a class="text-white text-decoration-none" href=https://linkedin.com/in/abe101 aria-label=linkedin><svg xmlns="http://www.w3.org/2000/svg" width="2.4em" height="2.4em" fill="#fff" aria-label="LinkedIn" viewBox="0 0 512 512"><rect width="512" height="512" fill="#0077b5" rx="15%"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a></span><a class="text-info text-decoration-none" href=https://twitter.com/habet_dot_dev aria-label=twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><path fill="#03a9f4" d="M42 37c0 2.762-2.239 5-5 5H11c-2.762.0-5-2.238-5-5V11c0-2.762 2.238-5 5-5h26c2.761.0 5 2.238 5 5V37z"/><path fill="#fff" d="M36 17.12c-.882.391-1.999.758-3 .88 1.018-.604 2.633-1.862 3-3-.951.559-2.671 1.156-3.793 1.372C31.311 15.422 30.033 15 28.617 15 25.897 15 24 17.305 24 20v2c-4 0-7.9-3.047-10.327-6-.427.721-.667 1.565-.667 2.457.0 1.819 1.671 3.665 2.994 4.543-.807-.025-2.335-.641-3-1 0 .016.0.036.0.057.0 2.367 1.661 3.974 3.912 4.422C16.501 26.592 16 27 14.072 27c.626 1.935 3.773 2.958 5.928 3-1.686 1.307-4.692 2-7 2-.399.0-.615.022-1-.023C14.178 33.357 17.22 34 20 34c9.057.0 14-6.918 14-13.37.0-.212-.007-.922-.018-1.13C34.95 18.818 35.342 18.104 36 17.12"/></svg></a></div><div class="container bg-transparent py-4"><div class="row justify-content-center"><div class="col-md-4 text-center order-2 order-lg-1 order-md-1"><div class=pb-2><a href=https://habet.dev><img alt="Footer logo" src=../../images/fav.png height=40px width=40px></a></div>&copy; 2022 All Rights Reserved<div>Made with &#10084; and
<a href=https://github.com/gurusabarish/hugo-profile target=_blank>Hugo profile</a>
| Designed and Developed by
<a href=https://www.linkedin.com/in/gurusabarish/ target=_blank>Gurusabarish</a></div></div></div></div></footer><script>$(function(){$('[data-toggle="tooltip"]').tooltip()})</script><script>function autoDarkMode(){$("body").toggleClass("darkmode");$(".fa-moon").addClass("d-none");$(".fa-sun").removeClass("d-none");$("nav").toggleClass("navbar-dark");$("nav").toggleClass("navbar-light");$('.text-dark').toggleClass('darkmode-text-dark');$('.text-muted').toggleClass('darkmode-text-muted');};</script><script src=../../js/auto_darkmode.js></script><script>$('.darkmode-label').click(function(){$("body").toggleClass("darkmode");$(".fa-moon").toggleClass("d-none");$(".fa-sun").toggleClass("d-none");$("nav").toggleClass("navbar-dark");$("nav").toggleClass("navbar-light");$('.text-dark').toggleClass('darkmode-text-dark');$('.text-muted').toggleClass('darkmode-text-muted');switchDarkmodeSetting();});</script></body></html>